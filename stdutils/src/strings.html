<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><style type="text/css">.symbol { color : #770055; background-color : transparent; border: 0px; margin: 0px;}
a.symbol:link { color : #229955; background-color : transparent; text-decoration: none; border: 0px; margin: 0px; }
a.symbol:active { color : #229955; background-color : transparent; text-decoration: none; border: 0px; margin: 0px; }
a.symbol:visited { color : #229955; background-color : transparent; text-decoration: none; border: 0px; margin: 0px; }
a.symbol:hover { color : #229955; background-color : transparent; text-decoration: none; border: 0px; margin: 0px; }
.special { color : #FF5000; background-color : inherit; }
.keyword { color : #770000; background-color : inherit; }
.comment { color : #007777; background-color : inherit; }
.string { color : #777777; background-color : inherit; }
.character { color : #0055AA; background-color : inherit; }
.syntaxerror { color : #FF0000; background-color : inherit; }
span.paren1:hover { color : inherit; background-color : #BAFFFF; }
span.paren2:hover { color : inherit; background-color : #FFCACA; }
span.paren3:hover { color : inherit; background-color : #FFFFBA; }
span.paren4:hover { color : inherit; background-color : #CACAFF; }
span.paren5:hover { color : inherit; background-color : #CAFFCA; }
span.paren6:hover { color : inherit; background-color : #FFBAFF; }

.default { background-color: white; color: black; }
.default:hover { background-color: white; color: black; }
</style><body>
<table width="100%"><tr><td class="default">
<tt><span class="comment">;;;; -*- Mode: Lisp; Syntax: ANSI-Common-Lisp; Base: 10 -*-<br>
</span><span class="comment">;;;; *************************************************************************<br>
</span><span class="comment">;;;; FILE IDENTIFICATION<br>
</span><span class="comment">;;;;<br>
</span><span class="comment">;;;; Name: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strings.lisp<br>
</span><span class="comment">;;;; Purpose: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Random string utilities<br>
</span><span class="comment">;;;; Programmer: &nbsp;&nbsp;&nbsp;Ian S Eslick<br>
</span><span class="comment">;;;; Date Started: &nbsp;March 2004<br>
</span><span class="comment">;;;;<br>
</span><span class="comment">;;;; *************************************************************************<br>
</span><br>
<span class="paren1">(<span class="default">in-package <span class="keyword">:stdutils</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defmacro-exported</span></i> <i><span class="symbol">with-string-stream</span></i> <span class="paren2">(<span class="default"><span class="paren3">(<span class="default">label</span>)</span> &amp;rest body</span>)</span><br>&nbsp;&nbsp;<span class="string">"Binds label to a string output stream and returns the<br>&nbsp;&nbsp;&nbsp;string representing the writes to that stream"</span><br>&nbsp;&nbsp;`<span class="paren2">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">,label <span class="paren5">(<span class="default">make-string-output-stream</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><i><span class="symbol">progn</span></i> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,@body<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">get-output-stream-string ,label</span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> mkstr <span class="paren2">(<span class="default">&amp;rest args</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">with-output-to-string</span></i> <span class="paren3">(<span class="default">s</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">dolist <span class="paren4">(<span class="default">a args</span>)</span> <span class="paren4">(<span class="default">princ a s</span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> symb <span class="paren2">(<span class="default">&amp;rest args</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">values <span class="paren3">(<span class="default">intern <span class="paren4">(<span class="default">apply #'mkstr args</span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> unsplit-words <span class="paren2">(<span class="default">list</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">apply #'concatenate 'string<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="paren3">(<span class="default">shuffle list<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren4">(<span class="default">repeat <span class="string">" "</span> <span class="paren5">(<span class="default">1- <span class="paren6">(<span class="default">length list</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> string-remove-characters <span class="paren2">(<span class="default">string char-list</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">optimize speed <span class="paren4">(<span class="default">safety 1</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">type string string</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">type list char-list</span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">assert <span class="paren3">(<span class="default">subtypep <span class="paren4">(<span class="default">type-of string</span>)</span> 'string</span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">output <span class="paren5">(<span class="default">copy-seq string</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">offset 0</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">type string output</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">type fixnum offset</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">dotimes <span class="paren4">(<span class="default">i <span class="paren5">(<span class="default">length string</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">unless <span class="paren5">(<span class="default">member <span class="paren6">(<span class="default">aref string i</span>)</span> char-list</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default">setf <span class="paren6">(<span class="default">aref output offset</span>)</span> <span class="paren6">(<span class="default">aref string i</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default">incf offset</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">subseq output 0 offset</span>)</span></span>)</span></span>)</span><br><br>
<span class="comment">;; -----------------------------------<br>
</span><span class="comment">;; Rule and data file utilities<br>
</span><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> strncmp <span class="paren2">(<span class="default"> string1 string2 count start </span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare #-mcl <span class="paren3">(<span class="default">type fixnum count start</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;#-mcl <span class="paren3">(<span class="default">type string string1 string2</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 3</span>)</span> <span class="paren4">(<span class="default">safety 1</span>)</span> <span class="paren4">(<span class="default">debug 1</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">ignore-errors <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><i><span class="symbol">loop</span></i> for i fixnum from start to <span class="paren4">(<span class="default">+ start count -1</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;finally <span class="paren4">(<span class="default">return t</span>)</span> do<br>
<span class="comment">;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(format t "~A ~A" (char string1 i) (char string2 i))<br>
</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">when <span class="paren5">(<span class="default">neq <span class="paren6">(<span class="default">schar string1 i</span>)</span> <span class="paren6">(<span class="default">schar string2 i</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default">return nil</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> strncmp-end2 <span class="paren2">(<span class="default"> string1 string2 count start </span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare #-mcl <span class="paren3">(<span class="default">type fixnum count start</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;#-mcl <span class="paren3">(<span class="default">type string string1 string2</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">inline char</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 3</span>)</span> <span class="paren4">(<span class="default">safety 1</span>)</span> <span class="paren4">(<span class="default">debug 1</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">ignore-errors <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><i><span class="symbol">loop</span></i> for i fixnum from 0 to <span class="paren4">(<span class="default">1- count</span>)</span> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;finally <span class="paren4">(<span class="default">return t</span>)</span> do<br>
<span class="comment">;; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(format t "~A ~A" (char string1 i) (char string2 i))<br>
</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">when <span class="paren5">(<span class="default">neq <span class="paren6">(<span class="default">char string1 i</span>)</span> <span class="paren6">(<span class="default">char string2 <span class="paren1">(<span class="default">+ i start</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default">return nil</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="comment">;;<br>
</span><span class="comment">;; Misc odd functions<br>
</span><span class="comment">;;<br>
</span><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> strlist-&gt;quoted-substrings <span class="paren2">(<span class="default">list</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">labels</span></i> <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">rec <span class="paren5">(<span class="default">list string</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default"><i><span class="symbol">if</span></i> <span class="paren6">(<span class="default">null list</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; string<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="paren6">(<span class="default">rec <span class="paren1">(<span class="default">cdr list</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren1">(<span class="default">concatenate 'string string<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="string">" </span><span class="string">\"</span><span class="string">"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren2">(<span class="default">car list</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="string">"</span><span class="string">\"</span><span class="string">"</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">string-left-trim-whitespace <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">rec list <span class="paren5">(<span class="default">string <span class="string">""</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<br>
<span class="comment">;; From KMRCL<br>
</span><br>
<span class="comment">;;;; -*- Mode: Lisp; Syntax: ANSI-Common-Lisp; Base: 10 -*-<br>
</span><span class="comment">;;;; *************************************************************************<br>
</span><span class="comment">;;;; FILE IDENTIFICATION<br>
</span><span class="comment">;;;;<br>
</span><span class="comment">;;;; Name: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strings.lisp<br>
</span><span class="comment">;;;; Purpose: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Strings utility functions for KMRCL package<br>
</span><span class="comment">;;;; Programmer: &nbsp;&nbsp;&nbsp;Kevin M. Rosenberg<br>
</span><span class="comment">;;;; Date Started: &nbsp;Apr 2000<br>
</span><span class="comment">;;;;<br>
</span><span class="comment">;;;; $Id: strings.lisp 9707 2004-06-28 16:39:19Z kevin $<br>
</span><span class="comment">;;;;<br>
</span><span class="comment">;;;; This file, part of KMRCL, is Copyright (c) 2002 by Kevin M. Rosenberg<br>
</span><span class="comment">;;;;<br>
</span><span class="comment">;;;; KMRCL users are granted the rights to distribute and use this software<br>
</span><span class="comment">;;;; as governed by the terms of the Lisp Lesser GNU Public License<br>
</span><span class="comment">;;;; (http://opensource.franz.com/preamble.html), also known as the LLGPL.<br>
</span><span class="comment">;;;; *************************************************************************<br>
</span><br>
<span class="comment">;;; Strings<br>
</span><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defmacro-exported</span></i> string-append <span class="paren2">(<span class="default">outputstr &amp;rest args</span>)</span><br>&nbsp;&nbsp;`<span class="paren2">(<span class="default"><i><span class="symbol">setq</span></i> ,outputstr <span class="paren3">(<span class="default">concatenate 'string ,outputstr ,@args</span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> list-to-string <span class="paren2">(<span class="default">lst</span>)</span><br>&nbsp;&nbsp;<span class="string">"Converts a list to a string, doesn't include any delimiters between elements"</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">format nil <span class="string">"~{~A~}"</span> lst</span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> count-string-words <span class="paren2">(<span class="default">str</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">simple-string str</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 3</span>)</span> <span class="paren4">(<span class="default">safety 0</span>)</span> <span class="paren4">(<span class="default">space 0</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">n-words 0</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">in-word nil</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">fixnum n-words</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">do* <span class="paren4">(<span class="default"><span class="paren5">(<span class="default">len <span class="paren6">(<span class="default">length str</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren5">(<span class="default">i 0 <span class="paren6">(<span class="default">1+ i</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><span class="paren5">(<span class="default">= i len</span>)</span> n-words</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">declare <span class="paren5">(<span class="default">fixnum i</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><i><span class="symbol">if</span></i> <span class="paren5">(<span class="default">alphanumericp <span class="paren6">(<span class="default">schar str i</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren5">(<span class="default">unless in-word<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<span class="paren6">(<span class="default">incf n-words</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<span class="paren6">(<span class="default"><i><span class="symbol">setq</span></i> in-word t</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default"><i><span class="symbol">setq</span></i> in-word nil</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="comment">;; From Larry Hunter with modifications<br>
</span><span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> position-char <span class="paren2">(<span class="default">char string start max</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 3</span>)</span> <span class="paren4">(<span class="default">safety 0</span>)</span> <span class="paren4">(<span class="default">space 0</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">fixnum start max</span>)</span> <span class="paren3">(<span class="default">simple-string string</span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">do* <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">i start <span class="paren5">(<span class="default">1+ i</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><span class="paren4">(<span class="default">= i max</span>)</span> nil</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">fixnum i</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">when <span class="paren4">(<span class="default">char= char <span class="paren5">(<span class="default">schar string i</span>)</span></span>)</span> <span class="paren4">(<span class="default">return i</span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> position-not-char <span class="paren2">(<span class="default">char string start max</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 3</span>)</span> <span class="paren4">(<span class="default">safety 0</span>)</span> <span class="paren4">(<span class="default">space 0</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">fixnum start max</span>)</span> <span class="paren3">(<span class="default">simple-string string</span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">do* <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">i start <span class="paren5">(<span class="default">1+ i</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><span class="paren4">(<span class="default">= i max</span>)</span> nil</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">fixnum i</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">when <span class="paren4">(<span class="default">char/= char <span class="paren5">(<span class="default">schar string i</span>)</span></span>)</span> <span class="paren4">(<span class="default">return i</span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> delimited-string-to-list <span class="paren2">(<span class="default">string &amp;optional <span class="paren3">(<span class="default">separator <span class="character">#\space</span></span>)</span> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;skip-terminal</span>)</span><br>&nbsp;&nbsp;<span class="string">"split a string with delimiter"</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 3</span>)</span> <span class="paren4">(<span class="default">safety 0</span>)</span> <span class="paren4">(<span class="default">space 0</span>)</span> <span class="paren4">(<span class="default">compilation-speed 0</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">type string string</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">type character separator</span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">do* <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">len <span class="paren5">(<span class="default">length string</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">output '<span class="paren5">(<span class="default"></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">pos 0</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">end <span class="paren5">(<span class="default">position-char separator string pos len</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default">position-char separator string pos len</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><span class="paren4">(<span class="default">null end</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><i><span class="symbol">if</span></i> <span class="paren5">(<span class="default">&lt; pos len</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default">push <span class="paren6">(<span class="default">subseq string pos</span>)</span> output</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default">when <span class="paren6">(<span class="default">or <span class="paren1">(<span class="default">not skip-terminal</span>)</span> <span class="paren1">(<span class="default">zerop len</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren6">(<span class="default">push <span class="string">""</span> output</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">nreverse output</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">type fixnum pos len</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">type <span class="paren5">(<span class="default">or null fixnum</span>)</span> end</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">push <span class="paren4">(<span class="default">subseq string pos end</span>)</span> output</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><i><span class="symbol">setq</span></i> pos <span class="paren4">(<span class="default">1+ end</span>)</span></span>)</span></span>)</span></span>)</span><br><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> list-to-delimited-string <span class="paren2">(<span class="default">list &amp;optional <span class="paren3">(<span class="default">separator <span class="string">" "</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">format nil <span class="paren3">(<span class="default">concatenate 'string <span class="string">"~{~A~^"</span> <span class="paren4">(<span class="default">string separator</span>)</span> <span class="string">"~}"</span></span>)</span> list</span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> string-invert <span class="paren2">(<span class="default">str</span>)</span><br>&nbsp;&nbsp;<span class="string">"Invert case of a string"</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 3</span>)</span> <span class="paren4">(<span class="default">compilation-speed 0</span>)</span> <span class="paren4">(<span class="default">debug 0</span>)</span> <span class="paren4">(<span class="default">safety 0</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">simple-string str</span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">up nil</span>)</span> <span class="paren4">(<span class="default">down nil</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><i><span class="symbol">block</span></i> skip<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><i><span class="symbol">loop</span></i> for char of-type character across str do<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default"><i><span class="symbol">cond</span></i> <span class="paren6">(<span class="default"><span class="paren1">(<span class="default">upper-case-p char</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren1">(<span class="default"><i><span class="symbol">if</span></i> down <span class="paren2">(<span class="default"><i><span class="symbol">return-from</span></i> skip str</span>)</span> <span class="paren2">(<span class="default">setf up t</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren6">(<span class="default"><span class="paren1">(<span class="default">lower-case-p char</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren1">(<span class="default"><i><span class="symbol">if</span></i> up &nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">return-from</span></i> skip str</span>)</span> <span class="paren2">(<span class="default">setf down t</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><i><span class="symbol">if</span></i> up <span class="paren5">(<span class="default">string-downcase str</span>)</span> <span class="paren5">(<span class="default">string-upcase str</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> add-sql-quotes <span class="paren2">(<span class="default">s</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">substitute-string-for-char s <span class="character">#\'</span> <span class="string">"''"</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> escape-backslashes <span class="paren2">(<span class="default">s</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">substitute-string-for-char s <span class="character">#\\</span> <span class="string">"</span><span class="string">\\</span><span class="string">\\</span><span class="string">"</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> substitute-string-for-char <span class="paren2">(<span class="default">procstr match-char subst-str</span>)</span> <br>&nbsp;&nbsp;<span class="string">"Substitutes a string for a single matching character of a string"</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">substitute-chars-strings procstr <span class="paren3">(<span class="default">list <span class="paren4">(<span class="default">cons match-char subst-str</span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> string-substitute <span class="paren2">(<span class="default">string substring replacement-string</span>)</span><br>&nbsp;&nbsp;<span class="string">"String substitute by Larry Hunter. Obtained from Google"</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">substring-length <span class="paren5">(<span class="default">length substring</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">last-end 0</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">new-string <span class="string">""</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">do <span class="paren4">(<span class="default"><span class="paren5">(<span class="default">next-start<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren6">(<span class="default">search substring string</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren6">(<span class="default">search substring string <span class="keyword">:start2</span> last-end</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><span class="paren5">(<span class="default">null next-start</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="paren5">(<span class="default">concatenate 'string new-string <span class="paren6">(<span class="default">subseq string last-end</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><i><span class="symbol">setq</span></i> new-string<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default">concatenate 'string<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;new-string<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren6">(<span class="default">subseq string last-end next-start</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;replacement-string</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><i><span class="symbol">setq</span></i> last-end <span class="paren5">(<span class="default">+ next-start substring-length</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> string-trim-last-character <span class="paren2">(<span class="default">s</span>)</span><br>&nbsp;&nbsp;<span class="string">"Return the string less the last character"</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">len <span class="paren5">(<span class="default">length s</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><i><span class="symbol">if</span></i> <span class="paren4">(<span class="default">plusp len</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">subseq s 0 <span class="paren5">(<span class="default">1- len</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s</span>)</span></span>)</span></span>)</span><br><br>
<span class="comment">;; NOTE: Fix this to nsubseq<br>
</span><span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> nstring-trim-last-character <span class="paren2">(<span class="default">s</span>)</span><br>&nbsp;&nbsp;<span class="string">"Return the string less the last character"</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">len <span class="paren5">(<span class="default">length s</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><i><span class="symbol">if</span></i> <span class="paren4">(<span class="default">plusp len</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">subseq s 0 <span class="paren5">(<span class="default">1- len</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s</span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> string-hash <span class="paren2">(<span class="default">str &amp;optional <span class="paren3">(<span class="default">bitmask 65535</span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">hash 0</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">fixnum hash</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">simple-string str</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">dotimes <span class="paren4">(<span class="default">i <span class="paren5">(<span class="default">length str</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">declare <span class="paren5">(<span class="default">fixnum i</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><i><span class="symbol">setq</span></i> hash <span class="paren5">(<span class="default">+ hash <span class="paren6">(<span class="default">char-code <span class="paren1">(<span class="default">char str i</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">logand hash bitmask</span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> is-string-empty <span class="paren2">(<span class="default">str</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">zerop <span class="paren3">(<span class="default">length str</span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defvar</span></i> <span class="special">*whitespace-chars*</span> '<span class="paren2">(<span class="default"><span class="character">#\space</span> <span class="character">#\tab</span> <span class="character">#\return</span> <span class="character">#\linefeed</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;#+allegro <span class="character">#\%space</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;#+lispworks <span class="character">#\No-Break-Space</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> is-char-whitespace <span class="paren2">(<span class="default">c</span>)</span> <br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">character c</span>)</span> <span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 3</span>)</span> <span class="paren4">(<span class="default">safety 0</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">or <span class="paren3">(<span class="default">char= c <span class="character">#\Space</span></span>)</span> <span class="paren3">(<span class="default">char= c <span class="character">#\Tab</span></span>)</span> <span class="paren3">(<span class="default">char= c <span class="character">#\Return</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">char= c <span class="character">#\Linefeed</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#+allegro <span class="paren3">(<span class="default">char= c <span class="character">#\%space</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#+lispworks <span class="paren3">(<span class="default">char= c <span class="character">#\No-Break-Space</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> is-string-whitespace <span class="paren2">(<span class="default">str</span>)</span><br>&nbsp;&nbsp;<span class="string">"Return t if string is all whitespace"</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">every #'is-char-whitespace str</span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> string-right-trim-whitespace <span class="paren2">(<span class="default">str</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">string-right-trim <span class="special">*whitespace-chars*</span> str</span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> string-left-trim-whitespace <span class="paren2">(<span class="default">str</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">string-left-trim <span class="special">*whitespace-chars*</span> str</span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> string-trim-whitespace <span class="paren2">(<span class="default">str</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">string-trim <span class="special">*whitespace-chars*</span> str</span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> replaced-string-length <span class="paren2">(<span class="default">str repl-alist</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">simple-string str</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 3</span>)</span> <span class="paren4">(<span class="default">safety 0</span>)</span> <span class="paren4">(<span class="default">space 0</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren2">(<span class="default">do* <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">i 0 <span class="paren5">(<span class="default">1+ i</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren4">(<span class="default">orig-len <span class="paren5">(<span class="default">length str</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren4">(<span class="default">new-len orig-len</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">= i orig-len</span>)</span> new-len</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">fixnum i orig-len new-len</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><i><span class="symbol">let*</span></i> <span class="paren4">(<span class="default"><span class="paren5">(<span class="default">c <span class="paren6">(<span class="default">char str i</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default">match <span class="paren6">(<span class="default">assoc c repl-alist <span class="keyword">:test</span> #'char=</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">declare <span class="paren5">(<span class="default">character c</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">when match<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren5">(<span class="default">incf new-len <span class="paren6">(<span class="default">1- <span class="paren1">(<span class="default">length<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">the</span></i> simple-string <span class="paren3">(<span class="default">cdr match</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> substitute-chars-strings <span class="paren2">(<span class="default">str repl-alist</span>)</span><br>&nbsp;&nbsp;<span class="string">"Replace all instances of a chars with a string. repl-alist is an assoc<br>list of characters and replacement strings."</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">simple-string str</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 3</span>)</span> <span class="paren4">(<span class="default">safety 0</span>)</span> <span class="paren4">(<span class="default">space 0</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">do* <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">orig-len <span class="paren5">(<span class="default">length str</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">new-string <span class="paren5">(<span class="default">make-string <span class="paren6">(<span class="default">replaced-string-length str repl-alist</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">spos 0 <span class="paren5">(<span class="default">1+ spos</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">dpos 0</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><span class="paren4">(<span class="default">&gt;= spos orig-len</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new-string</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">fixnum spos dpos</span>)</span> <span class="paren4">(<span class="default">simple-string new-string</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><i><span class="symbol">let*</span></i> <span class="paren4">(<span class="default"><span class="paren5">(<span class="default">c <span class="paren6">(<span class="default">char str spos</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren5">(<span class="default">match <span class="paren6">(<span class="default">assoc c repl-alist <span class="keyword">:test</span> #'char=</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">declare <span class="paren5">(<span class="default">character c</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><i><span class="symbol">if</span></i> match<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren5">(<span class="default"><i><span class="symbol">let*</span></i> <span class="paren6">(<span class="default"><span class="paren1">(<span class="default">subst <span class="paren2">(<span class="default">cdr match</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="paren1">(<span class="default">len <span class="paren2">(<span class="default">length subst</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<span class="paren6">(<span class="default">declare <span class="paren1">(<span class="default">fixnum len</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span class="paren1">(<span class="default">simple-string subst</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<span class="paren6">(<span class="default">dotimes <span class="paren1">(<span class="default">j len</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren1">(<span class="default">declare <span class="paren2">(<span class="default">fixnum j</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren1">(<span class="default">setf <span class="paren2">(<span class="default">char new-string dpos</span>)</span> <span class="paren2">(<span class="default">char subst j</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren1">(<span class="default">incf dpos</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default"><i><span class="symbol">progn</span></i><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren6">(<span class="default">setf <span class="paren1">(<span class="default">char new-string dpos</span>)</span> c</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren6">(<span class="default">incf dpos</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> escape-xml-string <span class="paren2">(<span class="default">string</span>)</span><br>&nbsp;&nbsp;<span class="string">"Escape invalid XML characters"</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">substitute-chars-strings string '<span class="paren3">(<span class="default"><span class="paren4">(<span class="default"><span class="character">#\&amp;</span> . <span class="string">"&amp;amp;"</span></span>)</span> <span class="paren4">(<span class="default"><span class="character">#\&lt;</span> . <span class="string">"&amp;lt;"</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> make-usb8-array <span class="paren2">(<span class="default">len</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">make-array len <span class="keyword">:element-type</span> '<span class="paren3">(<span class="default">unsigned-byte 8</span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> usb8-array-to-string <span class="paren2">(<span class="default">vec</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">type <span class="paren4">(<span class="default">simple-array <span class="paren5">(<span class="default">unsigned-byte 8</span>)</span> <span class="paren5">(<span class="default">*</span>)</span></span>)</span> vec</span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">let*</span></i> <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">len <span class="paren5">(<span class="default">length vec</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="paren4">(<span class="default">str <span class="paren5">(<span class="default">make-string len</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">fixnum len</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">simple-string str</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">optimize <span class="paren5">(<span class="default">speed 3</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">do <span class="paren4">(<span class="default"><span class="paren5">(<span class="default">i 0 <span class="paren6">(<span class="default">1+ i</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><span class="paren5">(<span class="default">= i len</span>)</span> str</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">declare <span class="paren5">(<span class="default">fixnum i</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">setf <span class="paren5">(<span class="default">schar str i</span>)</span> <span class="paren5">(<span class="default">code-char <span class="paren6">(<span class="default">aref vec i</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> string-to-usb8-array <span class="paren2">(<span class="default">str</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">simple-string str</span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">let*</span></i> <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">len <span class="paren5">(<span class="default">length str</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="paren4">(<span class="default">vec <span class="paren5">(<span class="default">make-usb8-array len</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">fixnum len</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">type <span class="paren5">(<span class="default">simple-array <span class="paren6">(<span class="default">unsigned-byte 8</span>)</span> <span class="paren6">(<span class="default">*</span>)</span></span>)</span> vec</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">optimize <span class="paren5">(<span class="default">speed 3</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">do <span class="paren4">(<span class="default"><span class="paren5">(<span class="default">i 0 <span class="paren6">(<span class="default">1+ i</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><span class="paren5">(<span class="default">= i len</span>)</span> vec</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">declare <span class="paren5">(<span class="default">fixnum i</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">setf <span class="paren5">(<span class="default">aref vec i</span>)</span> <span class="paren5">(<span class="default">char-code <span class="paren6">(<span class="default">schar str i</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> concat-separated-strings <span class="paren2">(<span class="default">separator &amp;rest lists</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">format nil <span class="paren3">(<span class="default">concatenate 'string <span class="string">"~{~A~^"</span> <span class="paren4">(<span class="default">string separator</span>)</span> <span class="string">"~}"</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren3">(<span class="default">append-sublists lists</span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> only-null-list-elements-p <span class="paren2">(<span class="default">lst</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">or <span class="paren3">(<span class="default">null lst</span>)</span> <span class="paren3">(<span class="default">every #'null lst</span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> print-separated-strings <span class="paren2">(<span class="default">strm separator &amp;rest lists</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 3</span>)</span> <span class="paren4">(<span class="default">safety 0</span>)</span> <span class="paren4">(<span class="default">space 0</span>)</span> <span class="paren4">(<span class="default">debug 0</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">compilation-speed 0</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">do* <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">rest-lists lists <span class="paren5">(<span class="default">cdr rest-lists</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">list <span class="paren5">(<span class="default">car rest-lists</span>)</span> <span class="paren5">(<span class="default">car rest-lists</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">last-list <span class="paren5">(<span class="default">only-null-list-elements-p <span class="paren6">(<span class="default">cdr rest-lists</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren5">(<span class="default">only-null-list-elements-p <span class="paren6">(<span class="default">cdr rest-lists</span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><span class="paren4">(<span class="default">null rest-lists</span>)</span> strm</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">do* <span class="paren4">(<span class="default"><span class="paren5">(<span class="default">lst list <span class="paren6">(<span class="default">cdr lst</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren5">(<span class="default">elem <span class="paren6">(<span class="default">car lst</span>)</span> <span class="paren6">(<span class="default">car lst</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren5">(<span class="default">last-elem <span class="paren6">(<span class="default">null <span class="paren1">(<span class="default">cdr lst</span>)</span></span>)</span> <span class="paren6">(<span class="default">null <span class="paren1">(<span class="default">cdr lst</span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="paren4">(<span class="default"><span class="paren5">(<span class="default">null lst</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">write-string elem strm</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">unless <span class="paren5">(<span class="default">and last-elem last-list</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default">write-string separator strm</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> prefixed-fixnum-string <span class="paren2">(<span class="default">num pchar len</span>)</span><br>&nbsp;&nbsp;<span class="string">"Outputs a string of LEN digit with an optional initial character PCHAR.<br>Leading zeros are present."</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 3</span>)</span> <span class="paren4">(<span class="default">safety 0</span>)</span> <span class="paren4">(<span class="default">space 0</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">type fixnum num len</span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">when pchar<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">incf len</span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">do* <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">zero-code <span class="paren5">(<span class="default">char-code <span class="character">#\0</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">result <span class="paren5">(<span class="default">make-string len <span class="keyword">:initial-element</span> <span class="character">#\0</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">minus? <span class="paren5">(<span class="default">minusp num</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">val <span class="paren5">(<span class="default"><i><span class="symbol">if</span></i> minus? <span class="paren6">(<span class="default">- num</span>)</span> num</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default">nth-value 0 <span class="paren6">(<span class="default">floor val 10</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">pos <span class="paren5">(<span class="default">1- len</span>)</span> <span class="paren5">(<span class="default">1- pos</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">mod <span class="paren5">(<span class="default">mod val 10</span>)</span> <span class="paren5">(<span class="default">mod val 10</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><span class="paren4">(<span class="default">or <span class="paren5">(<span class="default">zerop val</span>)</span> <span class="paren5">(<span class="default">minusp pos</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">when pchar<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="paren5">(<span class="default">setf <span class="paren6">(<span class="default">schar result 0</span>)</span> pchar</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">when minus? <span class="paren5">(<span class="default">setf <span class="paren6">(<span class="default">schar result <span class="paren1">(<span class="default"><i><span class="symbol">if</span></i> pchar 1 0</span>)</span></span>)</span> <span class="character">#\-</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">fixnum val mod zero-code pos</span>)</span> <span class="paren4">(<span class="default">simple-string result</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">setf <span class="paren4">(<span class="default">schar result pos</span>)</span> <span class="paren4">(<span class="default">code-char <span class="paren5">(<span class="default">+ zero-code mod</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> integer-string <span class="paren2">(<span class="default">num len</span>)</span><br>&nbsp;&nbsp;<span class="string">"Outputs a string of LEN digit with an optional initial character PCHAR.<br>Leading zeros are present."</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 3</span>)</span> <span class="paren4">(<span class="default">safety 0</span>)</span> <span class="paren4">(<span class="default">space 0</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">type fixnum len</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">type integer num</span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">do* <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">zero-code <span class="paren5">(<span class="default">char-code <span class="character">#\0</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">result <span class="paren5">(<span class="default">make-string len <span class="keyword">:initial-element</span> <span class="character">#\0</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">minus? <span class="paren5">(<span class="default">minusp num</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">val <span class="paren5">(<span class="default"><i><span class="symbol">if</span></i> minus? <span class="paren6">(<span class="default">- 0 num</span>)</span> num</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default">nth-value 0 <span class="paren6">(<span class="default">floor val 10</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">pos <span class="paren5">(<span class="default">1- len</span>)</span> <span class="paren5">(<span class="default">1- pos</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">mod <span class="paren5">(<span class="default">mod val 10</span>)</span> <span class="paren5">(<span class="default">mod val 10</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><span class="paren4">(<span class="default">or <span class="paren5">(<span class="default">zerop val</span>)</span> <span class="paren5">(<span class="default">minusp pos</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">when minus? <span class="paren5">(<span class="default">setf <span class="paren6">(<span class="default">schar result 0</span>)</span> <span class="character">#\-</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">fixnum mod zero-code pos</span>)</span> <span class="paren4">(<span class="default">simple-string result</span>)</span> <span class="paren4">(<span class="default">integer val</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">setf <span class="paren4">(<span class="default">schar result pos</span>)</span> <span class="paren4">(<span class="default">code-char <span class="paren5">(<span class="default">+ zero-code mod</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> fast-string-search <span class="paren2">(<span class="default">substr str substr-length startpos endpos</span>)</span><br>&nbsp;&nbsp;<span class="string">"Optimized search for a substring in a simple-string"</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">simple-string substr str</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">fixnum substr-length startpos endpos</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 3</span>)</span> <span class="paren4">(<span class="default">space 0</span>)</span> <span class="paren4">(<span class="default">safety 0</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">do* <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">pos startpos <span class="paren5">(<span class="default">1+ pos</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">lastpos <span class="paren5">(<span class="default">- endpos substr-length</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><span class="paren4">(<span class="default">&gt; pos lastpos</span>)</span> nil</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">fixnum pos lastpos</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">do <span class="paren4">(<span class="default"><span class="paren5">(<span class="default">i 0 <span class="paren6">(<span class="default">1+ i</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><span class="paren5">(<span class="default">= i substr-length</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="paren5">(<span class="default"><i><span class="symbol">return-from</span></i> fast-string-search pos</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">declare <span class="paren5">(<span class="default">fixnum i</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">unless <span class="paren5">(<span class="default">char= <span class="paren6">(<span class="default">schar str <span class="paren1">(<span class="default">+ i pos</span>)</span></span>)</span> <span class="paren6">(<span class="default">schar substr i</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default">return nil</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> string-delimited-string-to-list <span class="paren2">(<span class="default">str substr</span>)</span><br>&nbsp;&nbsp;<span class="string">"splits a string delimited by substr into a list of strings"</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">simple-string str substr</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 3</span>)</span> <span class="paren4">(<span class="default">safety 0</span>)</span> <span class="paren4">(<span class="default">space 0</span>)</span> <span class="paren4">(<span class="default">compilation-speed 0</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">debug 0</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">do* <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">substr-len <span class="paren5">(<span class="default">length substr</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">strlen <span class="paren5">(<span class="default">length str</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">output '<span class="paren5">(<span class="default"></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">pos 0</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">end <span class="paren5">(<span class="default">fast-string-search substr str substr-len pos strlen</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default">fast-string-search substr str substr-len pos strlen</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><span class="paren4">(<span class="default">null end</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">when <span class="paren5">(<span class="default">&lt; pos strlen</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren5">(<span class="default">push <span class="paren6">(<span class="default">subseq str pos</span>)</span> output</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">nreverse output</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">fixnum strlen substr-len pos</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">type <span class="paren5">(<span class="default">or fixnum null</span>)</span> end</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">push <span class="paren4">(<span class="default">subseq str pos end</span>)</span> output</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><i><span class="symbol">setq</span></i> pos <span class="paren4">(<span class="default">+ end substr-len</span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> string-to-list-skip-delimiter <span class="paren2">(<span class="default">str &amp;optional <span class="paren3">(<span class="default">delim <span class="character">#\space</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="string">"Return a list of strings, delimited by spaces, skipping spaces."</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">simple-string str</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 0</span>)</span> <span class="paren4">(<span class="default">space 0</span>)</span> <span class="paren4">(<span class="default">safety 0</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">do* <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">results '<span class="paren5">(<span class="default"></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">end <span class="paren5">(<span class="default">length str</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">i <span class="paren5">(<span class="default">position-not-char delim str 0 end</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren5">(<span class="default">position-not-char delim str j end</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">j <span class="paren5">(<span class="default">when i <span class="paren6">(<span class="default">position-char delim str i end</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren5">(<span class="default">when i <span class="paren6">(<span class="default">position-char delim str i end</span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><span class="paren4">(<span class="default">or <span class="paren5">(<span class="default">null i</span>)</span> <span class="paren5">(<span class="default">null j</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">when <span class="paren5">(<span class="default">and i <span class="paren6">(<span class="default">&lt; i end</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren5">(<span class="default">push <span class="paren6">(<span class="default">subseq str i end</span>)</span> results</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">nreverse results</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">fixnum end</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">type <span class="paren5">(<span class="default">or fixnum null</span>)</span> i j</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">push <span class="paren4">(<span class="default">subseq str i j</span>)</span> results</span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> string-starts-with <span class="paren2">(<span class="default">start str</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">and <span class="paren3">(<span class="default">&gt;= <span class="paren4">(<span class="default">length str</span>)</span> <span class="paren4">(<span class="default">length start</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">string-equal start str <span class="keyword">:end2</span> <span class="paren4">(<span class="default">length start</span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> count-string-char <span class="paren2">(<span class="default">s c</span>)</span><br>&nbsp;&nbsp;<span class="string">"Return a count of the number of times a character appears in a string"</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">simple-string s</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">character c</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 3</span>)</span> <span class="paren4">(<span class="default">safety 0</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">do <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">len <span class="paren5">(<span class="default">length s</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">i 0 <span class="paren5">(<span class="default">1+ i</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">count 0</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><span class="paren4">(<span class="default">= i len</span>)</span> count</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">fixnum i len count</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">when <span class="paren4">(<span class="default">char= <span class="paren5">(<span class="default">schar s i</span>)</span> c</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">incf count</span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> count-string-char-if <span class="paren2">(<span class="default">pred s</span>)</span><br>&nbsp;&nbsp;<span class="string">"Return a count of the number of times a predicate is true<br>for characters in a string"</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">simple-string s</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">type <span class="paren4">(<span class="default">or <i><span class="symbol">function</span></i> symbol</span>)</span> pred</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 3</span>)</span> <span class="paren4">(<span class="default">safety 0</span>)</span> <span class="paren4">(<span class="default">space 0</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">do <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">len <span class="paren5">(<span class="default">length s</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">i 0 <span class="paren5">(<span class="default">1+ i</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">count 0</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><span class="paren4">(<span class="default">= i len</span>)</span> count</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">fixnum i len count</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">when <span class="paren4">(<span class="default">funcall pred <span class="paren5">(<span class="default">schar s i</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">incf count</span>)</span></span>)</span></span>)</span></span>)</span><br><br><br>
<span class="comment">;;; URL Encoding<br>
</span><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> non-alphanumericp <span class="paren2">(<span class="default">ch</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">not <span class="paren3">(<span class="default">alphanumericp ch</span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defvar</span></i> +hex-chars+ <span class="string">"0123456789ABCDEF"</span></span>)</span><br>
<span class="paren1">(<span class="default">declaim <span class="paren2">(<span class="default">type simple-string +hex-chars+</span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> hexchar <span class="paren2">(<span class="default">n</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">type <span class="paren4">(<span class="default">integer 0 15</span>)</span> n</span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">schar +hex-chars+ n</span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defconstant</span></i> +char-code-lower-a+ <span class="paren2">(<span class="default">char-code <span class="character">#\a</span></span>)</span></span>)</span><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defconstant</span></i> +char-code-upper-a+ <span class="paren2">(<span class="default">char-code <span class="character">#\A</span></span>)</span></span>)</span><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defconstant</span></i> +char-code-0+ <span class="paren2">(<span class="default">char-code <span class="character">#\0</span></span>)</span></span>)</span><br>
<span class="paren1">(<span class="default">declaim <span class="paren2">(<span class="default">type fixnum +char-code-0+ +char-code-upper-a+<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+char-code-0</span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> charhex <span class="paren2">(<span class="default">ch</span>)</span><br>&nbsp;&nbsp;<span class="string">"convert hex character to decimal"</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">code <span class="paren5">(<span class="default">char-code <span class="paren6">(<span class="default">char-upcase ch</span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">fixnum ch</span>)</span></span>)</span> <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><i><span class="symbol">if</span></i> <span class="paren4">(<span class="default">&gt;= code +char-code-upper-a+</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">+ 10 <span class="paren5">(<span class="default">- code +char-code-upper-a+</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">- code +char-code-0+</span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> encode-uri-string <span class="paren2">(<span class="default">query</span>)</span><br>&nbsp;&nbsp;<span class="string">"Escape non-alphanumeric characters for URI fields"</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">simple-string query</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 3</span>)</span> <span class="paren4">(<span class="default">safety 0</span>)</span> <span class="paren4">(<span class="default">space 0</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">do* <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">count <span class="paren5">(<span class="default">count-string-char-if #'non-alphanumericp query</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">len <span class="paren5">(<span class="default">length query</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">new-len <span class="paren5">(<span class="default">+ len <span class="paren6">(<span class="default">* 2 count</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">str <span class="paren5">(<span class="default">make-string new-len</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">spos 0 <span class="paren5">(<span class="default">1+ spos</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">dpos 0 <span class="paren5">(<span class="default">1+ dpos</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><span class="paren4">(<span class="default">= spos len</span>)</span> str</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">fixnum count len new-len spos dpos</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">simple-string str</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren4">(<span class="default"><span class="paren5">(<span class="default">ch <span class="paren6">(<span class="default">schar query spos</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><i><span class="symbol">if</span></i> <span class="paren5">(<span class="default">non-alphanumericp ch</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren5">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren6">(<span class="default"><span class="paren1">(<span class="default">c <span class="paren2">(<span class="default">char-code ch</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<span class="paren6">(<span class="default">setf <span class="paren1">(<span class="default">schar str dpos</span>)</span> <span class="character">#\%</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<span class="paren6">(<span class="default">incf dpos</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<span class="paren6">(<span class="default">setf <span class="paren1">(<span class="default">schar str dpos</span>)</span> <span class="paren1">(<span class="default">hexchar <span class="paren2">(<span class="default">logand <span class="paren3">(<span class="default">ash c -4</span>)</span> 15</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<span class="paren6">(<span class="default">incf dpos</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<span class="paren6">(<span class="default">setf <span class="paren1">(<span class="default">schar str dpos</span>)</span> <span class="paren1">(<span class="default">hexchar <span class="paren2">(<span class="default">logand c 15</span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default">setf <span class="paren6">(<span class="default">schar str dpos</span>)</span> ch</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> decode-uri-string <span class="paren2">(<span class="default">query</span>)</span><br>&nbsp;&nbsp;<span class="string">"Unescape non-alphanumeric characters for URI fields"</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">simple-string query</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 3</span>)</span> <span class="paren4">(<span class="default">safety 0</span>)</span> <span class="paren4">(<span class="default">space 0</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">do* <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">count <span class="paren5">(<span class="default">count-string-char query <span class="character">#\%</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">len <span class="paren5">(<span class="default">length query</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">new-len <span class="paren5">(<span class="default">- len <span class="paren6">(<span class="default">* 2 count</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">str <span class="paren5">(<span class="default">make-string new-len</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">spos 0 <span class="paren5">(<span class="default">1+ spos</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">dpos 0 <span class="paren5">(<span class="default">1+ dpos</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><span class="paren4">(<span class="default">= spos len</span>)</span> str</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">fixnum count len new-len spos dpos</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">simple-string str</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren4">(<span class="default"><span class="paren5">(<span class="default">ch <span class="paren6">(<span class="default">schar query spos</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><i><span class="symbol">if</span></i> <span class="paren5">(<span class="default">char= <span class="character">#\%</span> ch</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren5">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren6">(<span class="default"><span class="paren1">(<span class="default">c1 <span class="paren2">(<span class="default">charhex <span class="paren3">(<span class="default">schar query <span class="paren4">(<span class="default">1+ spos</span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren1">(<span class="default">c2 <span class="paren2">(<span class="default">charhex <span class="paren3">(<span class="default">schar query <span class="paren4">(<span class="default">+ spos 2</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<span class="paren6">(<span class="default">declare <span class="paren1">(<span class="default">fixnum c1 c2</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<span class="paren6">(<span class="default">setf <span class="paren1">(<span class="default">schar str dpos</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren1">(<span class="default">code-char <span class="paren2">(<span class="default">logior c2 <span class="paren3">(<span class="default">ash c1 4</span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<span class="paren6">(<span class="default">incf spos 2</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default">setf <span class="paren6">(<span class="default">schar str dpos</span>)</span> ch</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">eval-when</span></i> <span class="paren2">(<span class="default"><span class="keyword">:compile-toplevel</span> <span class="keyword">:load-toplevel</span> <span class="keyword">:execute</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">defvar</span></i> +unambiguous-charset+<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"abcdefghjkmnpqrstuvwxyz123456789ABCDEFGHJKLMNPQSRTUVWXYZ"</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">defconstant</span></i> +unambiguous-length+ <span class="paren3">(<span class="default">length +unambiguous-charset+</span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> random-char <span class="paren2">(<span class="default">&amp;optional <span class="paren3">(<span class="default">set <span class="keyword">:lower-alpha</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">ecase set<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><span class="keyword">:lower-alpha</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">code-char <span class="paren5">(<span class="default">+ +char-code-lower-a+ <span class="paren6">(<span class="default">random 26</span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><span class="keyword">:lower-alphanumeric</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren5">(<span class="default"><span class="paren6">(<span class="default">n <span class="paren1">(<span class="default">random 36</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default"><i><span class="symbol">if</span></i> <span class="paren6">(<span class="default">&gt;= n 26</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren6">(<span class="default">code-char <span class="paren1">(<span class="default">+ +char-code-0+ <span class="paren2">(<span class="default">- n 26</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="paren6">(<span class="default">code-char <span class="paren1">(<span class="default">+ +char-code-lower-a+ n</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><span class="keyword">:upper-alpha</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">code-char <span class="paren5">(<span class="default">+ +char-code-upper-a+ <span class="paren6">(<span class="default">random 26</span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><span class="keyword">:unambiguous</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">schar +unambiguous-charset+ <span class="paren5">(<span class="default">random +unambiguous-length+</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><span class="keyword">:upper-lower-alpha</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren5">(<span class="default"><span class="paren6">(<span class="default">n <span class="paren1">(<span class="default">random 52</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default"><i><span class="symbol">if</span></i> <span class="paren6">(<span class="default">&gt;= n 26</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren6">(<span class="default">code-char <span class="paren1">(<span class="default">+ +char-code-upper-a+ <span class="paren2">(<span class="default">- n 26</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="paren6">(<span class="default">code-char <span class="paren1">(<span class="default">+ +char-code-lower-a+ n</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> random-string <span class="paren2">(<span class="default">&amp;key <span class="paren3">(<span class="default">length 10</span>)</span> <span class="paren3">(<span class="default">set <span class="keyword">:lower-alpha</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="string">"Returns a random lower-case string."</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 3</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">s <span class="paren5">(<span class="default">make-string length</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">simple-string s</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">dotimes <span class="paren4">(<span class="default">i length s</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">setf <span class="paren5">(<span class="default">schar s i</span>)</span> <span class="paren5">(<span class="default">random-char set</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> first-char <span class="paren2">(<span class="default">s</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">simple-string s</span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">when <span class="paren3">(<span class="default">and <span class="paren4">(<span class="default">stringp s</span>)</span> <span class="paren4">(<span class="default">plusp <span class="paren5">(<span class="default">length s</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">schar s 0</span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> last-char <span class="paren2">(<span class="default">s</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">simple-string s</span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">when <span class="paren3">(<span class="default">stringp s</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren4">(<span class="default"><span class="paren5">(<span class="default">len <span class="paren6">(<span class="default">length s</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">when <span class="paren5">(<span class="default">plusp len</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">schar s <span class="paren5">(<span class="default">1- len</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> ensure-string <span class="paren2">(<span class="default">v</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">typecase v<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">string v</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">character <span class="paren4">(<span class="default">string v</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">symbol <span class="paren4">(<span class="default">symbol-name v</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">otherwise <span class="paren4">(<span class="default">write-to-string v</span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> string-right-trim-one-char <span class="paren2">(<span class="default">char str</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">simple-string str</span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">let*</span></i> <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">len <span class="paren5">(<span class="default">length str</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="paren4">(<span class="default">last <span class="paren5">(<span class="default">1- len</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">fixnum len last</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><i><span class="symbol">if</span></i> <span class="paren4">(<span class="default">char= char <span class="paren5">(<span class="default">schar str last</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">subseq str 0 last</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str</span>)</span></span>)</span></span>)</span><br><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> string-strip-ending <span class="paren2">(<span class="default">str endings</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">if</span></i> <span class="paren3">(<span class="default">stringp endings</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><i><span class="symbol">setq</span></i> endings <span class="paren4">(<span class="default">list endings</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">len <span class="paren5">(<span class="default">length str</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">dolist <span class="paren4">(<span class="default">ending endings str</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">when <span class="paren5">(<span class="default">and <span class="paren6">(<span class="default">&gt;= len <span class="paren1">(<span class="default">length ending</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="paren6">(<span class="default">string-equal ending<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren1">(<span class="default">subseq str <span class="paren2">(<span class="default">- len<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">length ending</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default"><i><span class="symbol">return-from</span></i> string-strip-ending<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren6">(<span class="default">subseq str 0 <span class="paren1">(<span class="default">- len <span class="paren2">(<span class="default">length ending</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> string-maybe-shorten <span class="paren2">(<span class="default">str maxlen</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">string-elide str maxlen <span class="keyword">:end</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> string-elide <span class="paren2">(<span class="default">str maxlen position</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">fixnum maxlen</span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">len <span class="paren5">(<span class="default">length str</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">fixnum len</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><i><span class="symbol">cond</span></i><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><span class="paren5">(<span class="default">&lt;= len maxlen</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><span class="paren5">(<span class="default">&lt;= maxlen 3</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"..."</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><span class="paren5">(<span class="default">eq position <span class="keyword">:middle</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default">multiple-value-bind <span class="paren6">(<span class="default">mid remain</span>)</span> <span class="paren6">(<span class="default">truncate maxlen 2</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren6">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren1">(<span class="default"><span class="paren2">(<span class="default">end1 <span class="paren3">(<span class="default">- mid 1</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren2">(<span class="default">start2 <span class="paren3">(<span class="default">- len <span class="paren4">(<span class="default">- mid 2</span>)</span> remain</span>)</span></span>)</span></span>)</span> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren1">(<span class="default">concatenate 'string <span class="paren2">(<span class="default">subseq str 0 end1</span>)</span> <span class="string">"..."</span> <span class="paren2">(<span class="default">subseq str start2</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><span class="paren5">(<span class="default">or <span class="paren6">(<span class="default">eq position <span class="keyword">:end</span></span>)</span> t</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default">concatenate 'string <span class="paren6">(<span class="default">subseq str 0 <span class="paren1">(<span class="default">- maxlen 3</span>)</span></span>)</span> <span class="string">"..."</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> shrink-vector <span class="paren2">(<span class="default">str size</span>)</span><br>&nbsp;&nbsp;#+allegro<br>&nbsp;&nbsp;<span class="paren2">(<span class="default">excl::.primcall 'sys::shrink-svector str size</span>)</span><br>&nbsp;&nbsp;#+cmu<br>&nbsp;&nbsp;<span class="paren2">(<span class="default">lisp::shrink-vector str size</span>)</span><br>&nbsp;&nbsp;#+lispworks<br>&nbsp;&nbsp;<span class="paren2">(<span class="default">system::shrink-vector$vector str size</span>)</span><br>&nbsp;&nbsp;#+sbcl<br>&nbsp;&nbsp;<span class="paren2">(<span class="default">sb-kernel:shrink-vector str size</span>)</span><br>&nbsp;&nbsp;#+scl<br>&nbsp;&nbsp;<span class="paren2">(<span class="default">common-lisp::shrink-vector str size</span>)</span><br>&nbsp;&nbsp;#-<span class="paren2">(<span class="default">or allegro cmu lispworks sbcl scl</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">setq</span></i> str <span class="paren3">(<span class="default">subseq str 0 size</span>)</span></span>)</span><br>&nbsp;&nbsp;str</span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> lex-string <span class="paren2">(<span class="default">string &amp;key <span class="paren3">(<span class="default">whitespace '<span class="paren4">(<span class="default"><span class="character">#\space</span> <span class="character">#\newline</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="string">"Separates a string at whitespace and returns a list of strings"</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">flet</span></i> <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">is-sep <span class="paren5">(<span class="default">char</span>)</span> <span class="paren5">(<span class="default">member char whitespace <span class="keyword">:test</span> #'char=</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren4">(<span class="default"><span class="paren5">(<span class="default">tokens nil</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">do* <span class="paren5">(<span class="default"><span class="paren6">(<span class="default">token-start<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren1">(<span class="default">position-if-not #'is-sep string</span>)</span> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren1">(<span class="default">when token-end<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren2">(<span class="default">position-if-not #'is-sep string <span class="keyword">:start</span> <span class="paren3">(<span class="default">1+ token-end</span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren6">(<span class="default">token-end<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren1">(<span class="default">when token-start<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren2">(<span class="default">position-if #'is-sep string <span class="keyword">:start</span> token-start</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren1">(<span class="default">when token-start<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren2">(<span class="default">position-if #'is-sep string <span class="keyword">:start</span> token-start</span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default"><span class="paren6">(<span class="default">null token-start</span>)</span> <span class="paren6">(<span class="default">nreverse tokens</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default">push <span class="paren6">(<span class="default">subseq string token-start token-end</span>)</span> tokens</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> split-alphanumeric-string <span class="paren2">(<span class="default">string</span>)</span><br>&nbsp;&nbsp;<span class="string">"Separates a string at any non-alphanumeric chararacter"</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">simple-string string</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 3</span>)</span> <span class="paren4">(<span class="default">safety 0</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">flet</span></i> <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">is-sep <span class="paren5">(<span class="default">char</span>)</span> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren5">(<span class="default">declare <span class="paren6">(<span class="default">character char</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren5">(<span class="default">and <span class="paren6">(<span class="default">non-alphanumericp char</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren6">(<span class="default">not <span class="paren1">(<span class="default">char= <span class="character">#\_</span> char</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren4">(<span class="default"><span class="paren5">(<span class="default">tokens nil</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">do* <span class="paren5">(<span class="default"><span class="paren6">(<span class="default">token-start<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren1">(<span class="default">position-if-not #'is-sep string</span>)</span> <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren1">(<span class="default">when token-end<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren2">(<span class="default">position-if-not #'is-sep string <span class="keyword">:start</span> <span class="paren3">(<span class="default">1+ token-end</span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren6">(<span class="default">token-end<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren1">(<span class="default">when token-start<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren2">(<span class="default">position-if #'is-sep string <span class="keyword">:start</span> token-start</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren1">(<span class="default">when token-start<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren2">(<span class="default">position-if #'is-sep string <span class="keyword">:start</span> token-start</span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default"><span class="paren6">(<span class="default">null token-start</span>)</span> <span class="paren6">(<span class="default">nreverse tokens</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default">push <span class="paren6">(<span class="default">subseq string token-start token-end</span>)</span> tokens</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> trim-non-alphanumeric <span class="paren2">(<span class="default">word</span>)</span><br>&nbsp;&nbsp;<span class="string">"Strip non-alphanumeric characters from beginning and end of a word."</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">simple-string word</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 3</span>)</span> <span class="paren4">(<span class="default">safety 0</span>)</span> <span class="paren4">(<span class="default">space 0</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">let*</span></i> <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">start 0</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="paren4">(<span class="default">len <span class="paren5">(<span class="default">length word</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="paren4">(<span class="default">end len</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">declare <span class="paren4">(<span class="default">fixnum start end len</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">do <span class="paren4">(<span class="default"><span class="paren5">(<span class="default">done nil</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><span class="paren5">(<span class="default">or done <span class="paren6">(<span class="default">= start end</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><i><span class="symbol">if</span></i> <span class="paren5">(<span class="default">alphanumericp <span class="paren6">(<span class="default">schar word start</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren5">(<span class="default"><i><span class="symbol">setq</span></i> done t</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default">incf start</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">when <span class="paren4">(<span class="default">&gt; end start</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">do <span class="paren5">(<span class="default"><span class="paren6">(<span class="default">done nil</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren5">(<span class="default"><span class="paren6">(<span class="default">or done <span class="paren1">(<span class="default">= start end</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default"><i><span class="symbol">if</span></i> <span class="paren6">(<span class="default">alphanumericp <span class="paren1">(<span class="default">schar word <span class="paren2">(<span class="default">1- end</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<span class="paren6">(<span class="default"><i><span class="symbol">setq</span></i> done t</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren6">(<span class="default">decf end</span>)</span></span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><i><span class="symbol">if</span></i> <span class="paren4">(<span class="default">or <span class="paren5">(<span class="default">plusp start</span>)</span> <span class="paren5">(<span class="default">/= len end</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">subseq word start end</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;word</span>)</span></span>)</span></span>)</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> collapse-whitespace <span class="paren2">(<span class="default">s</span>)</span><br>&nbsp;&nbsp;<span class="string">"Convert multiple whitespace characters to a single space character."</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default">declare <span class="paren3">(<span class="default">simple-string s</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="paren3">(<span class="default">optimize <span class="paren4">(<span class="default">speed 3</span>)</span> <span class="paren4">(<span class="default">safety 0</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">with-output-to-string</span></i> <span class="paren3">(<span class="default">stream</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default">do <span class="paren4">(<span class="default"><span class="paren5">(<span class="default">pos 0 <span class="paren6">(<span class="default">1+ pos</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="paren5">(<span class="default">in-white nil</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="paren5">(<span class="default">len <span class="paren6">(<span class="default">length s</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><span class="paren5">(<span class="default">= pos len</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">declare <span class="paren5">(<span class="default">fixnum pos len</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren5">(<span class="default"><span class="paren6">(<span class="default">c <span class="paren1">(<span class="default">schar s pos</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default">declare <span class="paren6">(<span class="default">character c</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default"><i><span class="symbol">cond</span></i><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="paren6">(<span class="default"><span class="paren1">(<span class="default">is-char-whitespace c</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren1">(<span class="default">unless in-white<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<span class="paren2">(<span class="default">write-char <span class="character">#\space</span> stream</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren1">(<span class="default"><i><span class="symbol">setq</span></i> in-white t</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="paren6">(<span class="default">t<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren1">(<span class="default"><i><span class="symbol">setq</span></i> in-white nil</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="paren1">(<span class="default">write-char c stream</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br><br>
<span class="paren1">(<span class="default"><i><span class="symbol">defun-exported</span></i> string-&gt;list <span class="paren2">(<span class="default">string</span>)</span><br>&nbsp;&nbsp;<span class="paren2">(<span class="default"><i><span class="symbol">let</span></i> <span class="paren3">(<span class="default"><span class="paren4">(<span class="default">eof <span class="paren5">(<span class="default">list nil</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren3">(<span class="default"><i><span class="symbol">with-input-from-string</span></i> <span class="paren4">(<span class="default">stream string</span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren4">(<span class="default">do <span class="paren5">(<span class="default"><span class="paren6">(<span class="default">x <span class="paren1">(<span class="default">read stream nil eof</span>)</span> <span class="paren1">(<span class="default">read stream nil eof</span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren6">(<span class="default">l nil <span class="paren1">(<span class="default">cons x l</span>)</span></span>)</span></span>)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="paren5">(<span class="default"><span class="paren6">(<span class="default">eq x eof</span>)</span> <span class="paren6">(<span class="default">nreverse l</span>)</span></span>)</span></span>)</span></span>)</span></span>)</span></span>)</span><br>
</tt>
</tr></td></table></body></html>